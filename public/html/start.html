<html>
    <head>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.5.0/firebase-auth.js"></script>
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyBlPLppOtBkBo6XYq3wm17EGNOy8FhsUpM",
                authDomain: "shutappsweb.firebaseapp.com",
                databaseURL: "https://shutappsweb.firebaseio.com",
                projectId: "shutappsweb",
                storageBucket: "",
                messagingSenderId: "336718505369"
            };
            firebase.initializeApp(config);
        </script>
        
        <script>
            function handleSignUp() {
              var email = document.getElementById('email').value;
              var password = document.getElementById('password').value;
              if (email.length < 4) {
                alert('Please enter an email address.');
                return;
              }
              if (password.length < 4) {
                alert('Please enter a password.');
                return;
              }
              // Sign in with email and pass.
              // [START createwithemail]
              firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // [START_EXCLUDE]
                if (errorCode == 'auth/weak-password') {
                  alert('The password is too weak.');
                } else {
                  alert(errorMessage);
                }
                console.log(error);
                // [END_EXCLUDE]
              });
              // [END createwithemail]
            }
            
            function toggleSignIn() {
              if (firebase.auth().currentUser) {
                // [START signout]
                firebase.auth().signOut();
                // [END signout]
              } else {
                var email = document.getElementById('email').value;
                var password = document.getElementById('password').value;
                if (email.length < 4) {
                  alert('Please enter an email address.');
                  return;
                }
                if (password.length < 4) {
                  alert('Please enter a password.');
                  return;
                }
                // Sign in with email and pass.
                // [START authwithemail]
                firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
                  // Handle Errors here.
                  var errorCode = error.code;
                  var errorMessage = error.message;
                  // [START_EXCLUDE]
                  if (errorCode === 'auth/wrong-password') {
                    alert('Wrong password.');
                  } else {
                    alert(errorMessage);
                  }
                  console.log(error);
                  // [END_EXCLUDE]
                });
                // [END authwithemail]
              }
            }
            
            function signOut() {
                firebase.auth().signOut().then(function() {
                    console.log('user logged out');
                }, function(error) {
                    console.log(error);
                });
            }
            
            window.onload = function() {
                
                firebase.auth().onAuthStateChanged(function(user) {
                    if(user) {
                        console.log('logged in');
                        /*firebase.auth().currentUser.getIdToken(true).then(function(idToken) {
                            console.log(idToken);
                            var data = {
                                idToken: idToken
                            };
                            $.ajax({
                                type: 'POST',
                                url: '/verify',
                                data: JSON.stringify(data),
                                contentType: 'application/json'
                            }).done(function(response, status, header) {
                                console.log('idToken gesendet');
                            }).fail(function(error) {
                                console.log('idToken konnte nicht gesendet werden');
                            });
                        }).catch(function(error) {
                            console.log(error);
                        });*/
                        window.location.replace('/start');
                    } else {     
                        document.getElementById('sign-up').addEventListener('click', handleSignUp, false);
                        document.getElementById('sign-in').addEventListener('click', toggleSignIn, false);
                    }
                });
                document.getElementById('sign-out').addEventListener('click', signOut, false);
            };   
        </script>
    </head>
    <body>
        <input type="text" id="email" placeholder="Email">
        <input type="password" id="password" placerholder="Password">
        <button id="sign-up" name="sign-up">Sign Up</button>
        <button id="sign-in" name="sign-in">Sign In</button>
        <button id="sign-out" name="sign-out">Sign Out</button>
    </body>
</html>